<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Navigator - ìƒì¡´í˜• í• ì¼ ê´€ë¦¬</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
      background: #0a0a0a;
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .app {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      padding-bottom: 100px;
    }

    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
    .tab-nav {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      background: #1a1a1a;
      padding: 10px;
      border-radius: 12px;
      overflow-x: auto;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .tab-btn {
      padding: 12px 20px;
      background: transparent;
      border: none;
      color: #999;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .tab-btn.active {
      background: #667eea;
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }
    
    .header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .header h1 {
      font-size: 32px;
      margin-bottom: 5px;
    }
    
    .header p {
      color: #999;
      font-size: 14px;
    }
    
    .shuttle-status {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 20px;
      cursor: pointer;
      transition: transform 0.2s;
      user-select: none;
    }
    
    .shuttle-status:active {
      transform: scale(0.98);
    }
    
    .shuttle-status.failed {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .shuttle-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    .shuttle-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .shuttle-desc {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .mode-indicator {
      background: #1a1a1a;
      padding: 12px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 20px;
      font-size: 14px;
      border: 1px solid #333;
    }
    
    .time-remaining {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
      border: 2px solid #333;
    }
    
    .time-remaining.panic {
      border-color: #f5576c;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .time-label {
      font-size: 14px;
      color: #999;
      margin-bottom: 10px;
    }
    
    .time-value {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .time-warning {
      font-size: 14px;
      color: #f5576c;
      margin-top: 10px;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid #333;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 12px;
      color: #999;
    }

    /* ë°±ì—… ì„¹ì…˜ */
    .backup-section {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid #333;
    }

    .backup-title {
      font-size: 14px;
      color: #999;
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .backup-buttons {
      display: flex;
      gap: 10px;
    }

    .backup-btn {
      flex: 1;
      padding: 12px;
      background: #2a2a2a;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .backup-btn:hover {
      background: #3a3a3a;
    }

    .backup-btn.export {
      background: #667eea;
    }

    .backup-btn.import {
      background: #48bb78;
    }

    /* ëŒ€ì‹œë³´ë“œ */
    .dashboard-section {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid #333;
    }

    .dashboard-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .category-stats {
      display: grid;
      gap: 15px;
      margin-bottom: 20px;
    }

    .category-stat {
      background: #2a2a2a;
      padding: 15px;
      border-radius: 12px;
    }

    .category-stat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .category-name {
      font-weight: bold;
      font-size: 16px;
    }

    .category-progress {
      font-size: 14px;
      color: #999;
    }

    .progress-bar {
      height: 8px;
      background: #1a1a1a;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      transition: width 0.3s;
    }

    .progress-fill.ë³¸ì—… { background: #667eea; }
    .progress-fill.ë¶€ì—… { background: #f093fb; }
    .progress-fill.ì¼ìƒ { background: #48bb78; }

    .urgent-list {
      display: grid;
      gap: 10px;
    }

    .urgent-item {
      background: #2a2a2a;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #f5576c;
    }

    .urgent-item-title {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .urgent-item-time {
      font-size: 12px;
      color: #f5576c;
    }
    
    /* ë¹ ë¥¸ ì¶”ê°€ */
    .quick-add {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 2px solid #667eea;
    }
    
    .quick-add-header {
      font-size: 14px;
      color: #999;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .quick-add-input-group {
      display: flex;
      gap: 10px;
    }
    
    .quick-add-input {
      flex: 1;
      padding: 16px;
      background: #2a2a2a;
      border: 1px solid #333;
      border-radius: 12px;
      color: white;
      font-size: 16px;
      font-family: inherit;
    }
    
    .quick-add-input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .quick-add-btn {
      padding: 16px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
      white-space: nowrap;
    }
    
    .quick-add-btn:active {
      transform: scale(0.95);
    }
    
    .quick-add-toggle {
      margin-top: 10px;
      text-align: center;
      color: #667eea;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
    }
    
    /* Next Action */
    .next-action {
      background: #1a1a1a;
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 20px;
      border: 2px solid #667eea;
    }
    
    .next-action.panic {
      border-color: #f5576c;
      background: linear-gradient(135deg, #2a1a1a 0%, #1a1a1a 100%);
      animation: pulse-border 1s infinite;
    }
    
    @keyframes pulse-border {
      0%, 100% { border-color: #f5576c; }
      50% { border-color: #ff7a8a; }
    }
    
    .next-action.warning {
      border-color: #ff9500;
    }
    
    .next-action-label {
      font-size: 14px;
      color: #999;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .next-action.panic .next-action-label {
      color: #f5576c;
    }
    
    .next-action.warning .next-action-label {
      color: #ff9500;
    }
    
    .task-title {
      font-size: 28px;
      margin-bottom: 20px;
      line-height: 1.3;
    }
    
    .task-meta {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .category {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: bold;
    }
    
    .category.ë³¸ì—… { background: #667eea; }
    .category.ë¶€ì—… { background: #f093fb; }
    .category.ì¼ìƒ { background: #48bb78; }
    
    .meta-item {
      background: #2a2a2a;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn {
      padding: 20px 32px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-bottom: 12px;
      transition: transform 0.2s, opacity 0.2s;
      user-select: none;
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-success {
      background: #48bb78;
      color: white;
    }
    
    .btn-secondary {
      background: #2a2a2a;
      color: white;
    }
    
    /* ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ */
    .task-list-section {
      margin-bottom: 20px;
    }
    
    .task-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: #1a1a1a;
      border-radius: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      user-select: none;
      border: 1px solid #333;
    }
    
    .task-list-title {
      font-size: 16px;
      font-weight: bold;
    }
    
    .task-list-count {
      font-size: 14px;
      color: #999;
    }
    
    .task-list {
      display: none;
    }
    
    .task-list.show {
      display: block;
    }
    
    .task-item {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 10px;
      border: 1px solid #333;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s, opacity 0.3s;
    }
    
    .task-item.swiping-left {
      transform: translateX(-100px);
    }
    
    .task-item.swiping-right {
      transform: translateX(100px);
    }
    
    .task-item.completed {
      opacity: 0.6;
      background: #151515;
    }
    
    .task-item.urgent {
      border-color: #f5576c;
      border-width: 2px;
    }
    
    .task-item.warning {
      border-color: #ff9500;
      border-width: 2px;
    }
    
    .swipe-actions {
      position: absolute;
      top: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 20px;
      font-size: 14px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .task-item.swiping-left .swipe-actions.left,
    .task-item.swiping-right .swipe-actions.right {
      opacity: 1;
    }
    
    .swipe-actions.left {
      left: 0;
      background: #48bb78;
    }
    
    .swipe-actions.right {
      right: 0;
      background: #f5576c;
    }
    
    .task-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    
    .task-item-title {
      font-weight: bold;
      font-size: 16px;
      flex: 1;
      margin-right: 10px;
    }

    .task-item-title.completed {
      text-decoration: line-through;
      opacity: 0.6;
    }
    
    .task-item-meta {
      font-size: 12px;
      color: #999;
      margin-bottom: 10px;
    }
    
    .task-item-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .btn-small {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      background: #2a2a2a;
      color: white;
      transition: transform 0.2s;
      font-weight: 500;
    }
    
    .btn-small:active {
      transform: scale(0.95);
    }
    
    .btn-small.delete {
      background: #f5576c;
    }
    
    .btn-small.go {
      background: #667eea;
    }
    
    .btn-small.complete {
      background: #48bb78;
    }

    .btn-small.uncomplete {
      background: #ff9500;
    }

    .btn-small.edit {
      background: #667eea;
    }
    
    .hidden-tasks {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
      color: #999;
      font-size: 14px;
      border: 1px solid #333;
    }
    
    .add-task-section {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid #667eea;
      border-width: 2px;
    }
    
    .add-task-section h3 {
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #999;
    }
    
    .form-input, .form-select {
      width: 100%;
      padding: 16px;
      background: #2a2a2a;
      border: 1px solid #333;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      font-family: inherit;
    }
    
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-note {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #2a2a2a;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        transform: translateX(-50%) translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    .toast.success {
      background: #48bb78;
    }

    .toast.error {
      background: #f5576c;
    }

    /* íˆë“  íŒŒì¼ ì¸í’‹ */
    .hidden-input {
      display: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <!-- íŒŒì¼ ì—…ë¡œë“œìš© íˆë“  ì¸í’‹ -->
  <input type="file" id="file-import" class="hidden-input" accept=".json">

  <script>
    // ============================================
    // ì•± ìƒíƒœ ê´€ë¦¬
    // ============================================
    const appState = {
      currentTab: 'action',           // í˜„ì¬ í™œì„± íƒ­
      shuttleSuccess: false,          // ì…”í‹€ íƒ‘ìŠ¹ ì—¬ë¶€
      tasks: [],                      // ëª¨ë“  ì‘ì—… ëª©ë¡
      showDetailedAdd: false,         // ìƒì„¸ ì¶”ê°€ í¼ í‘œì‹œ ì—¬ë¶€
      showTaskList: true,             // ì‘ì—… ë¦¬ìŠ¤íŠ¸ í‘œì‹œ ì—¬ë¶€
      showCompletedTasks: false,      // ì™„ë£Œëœ ì‘ì—… í‘œì‹œ ì—¬ë¶€
      quickAddValue: '',              // ë¹ ë¥¸ ì¶”ê°€ ì…ë ¥ê°’
      detailedTask: {                 // ìƒì„¸ ì¶”ê°€/ìˆ˜ì •ìš© ì„ì‹œ ë°ì´í„°
        title: '',
        category: 'ë¶€ì—…',
        deadline: '',
        estimatedTime: 10,
        link: '',
        expectedRevenue: ''
      },
      editingTaskId: null,            // ìˆ˜ì • ì¤‘ì¸ ì‘ì—… ID (nullì´ë©´ ìƒˆë¡œ ì¶”ê°€)
      touchStart: null,               // ìŠ¤ì™€ì´í”„ ì‹œì‘ ì§€ì 
      touchingTaskId: null            // ìŠ¤ì™€ì´í”„ ì¤‘ì¸ ì‘ì—… ID
    };

    // ============================================
    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬
    // ============================================
    
    /**
     * ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
     * ì—ëŸ¬ ì²˜ë¦¬ í¬í•¨
     */
    function loadState() {
      try {
        const savedTasks = localStorage.getItem('navigator-tasks');
        if (savedTasks) {
          appState.tasks = JSON.parse(savedTasks);
        }
        
        const savedShuttle = localStorage.getItem('navigator-shuttle');
        if (savedShuttle) {
          appState.shuttleSuccess = JSON.parse(savedShuttle);
        }
      } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        showToast('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }

    /**
     * ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥
     * ì—ëŸ¬ ì²˜ë¦¬ í¬í•¨
     */
    function saveState() {
      try {
        localStorage.setItem('navigator-tasks', JSON.stringify(appState.tasks));
        localStorage.setItem('navigator-shuttle', JSON.stringify(appState.shuttleSuccess));
      } catch (error) {
        console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
        showToast('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }

    // ============================================
    // ìš°ì„ ìˆœìœ„ ê³„ì‚° ë¡œì§
    // ============================================
    
    /**
     * ì‘ì—…ì˜ ìš°ì„ ìˆœìœ„ ì ìˆ˜ ê³„ì‚°
     * ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ìš°ì„ ìˆœìœ„ ë†’ìŒ
     */
    function calculatePriority(task) {
      let score = 0;
      const now = new Date();
      
      // 1. ë§ˆê°ì‹œê°„ ê¸°ë°˜ ì ìˆ˜ (ê°€ì¥ ì¤‘ìš”)
      if (task.deadline) {
        const deadline = new Date(task.deadline);
        const hoursLeft = (deadline - now) / (1000 * 60 * 60);
        
        if (hoursLeft < 0) score -= 100;      // ì´ë¯¸ ì§€ë‚¨: íŒ¨ë„í‹°
        else if (hoursLeft < 3) score += 100; // 3ì‹œê°„ ë‚´: ìµœìš°ì„ 
        else if (hoursLeft < 24) score += 70; // í•˜ë£¨ ë‚´: ë†’ì€ ìš°ì„ ìˆœìœ„
        else if (hoursLeft < 72) score += 40; // 3ì¼ ë‚´: ì¤‘ê°„ ìš°ì„ ìˆœìœ„
      }
      
      // 2. ì¹´í…Œê³ ë¦¬ ê¸°ë³¸ ì ìˆ˜
      if (task.category === 'ë³¸ì—…') score += 40;
      else if (task.category === 'ë¶€ì—…') score += 35;
      else if (task.category === 'ì¼ìƒ') score += 25;
      
      // 3. ë¶€ì—…ì˜ ê²½ìš° ROI ê³„ì‚° (ìˆ˜ìµ/ì‹œê°„)
      if (task.category === 'ë¶€ì—…' && task.expectedRevenue) {
        const roi = task.expectedRevenue / task.estimatedTime;
        score += Math.min(roi * 0.1, 30); // ìµœëŒ€ 30ì ê¹Œì§€
      }
      
      // 4. ì§§ì€ ì‘ì—… ìš°ëŒ€ (ë¹ ë¥¸ ì„±ì·¨ê°)
      if (task.estimatedTime <= 10) score += 10;
      
      return score;
    }

    /**
     * ì‘ì—…ì˜ ê¸´ê¸‰ë„ ë ˆë²¨ ë°˜í™˜
     */
    function getUrgencyLevel(task) {
      if (!task.deadline) return 'normal';
      
      const now = new Date();
      const deadline = new Date(task.deadline);
      const hoursLeft = (deadline - now) / (1000 * 60 * 60);
      
      if (hoursLeft < 0) return 'expired';   // ë§ˆê° ì§€ë‚¨
      if (hoursLeft < 3) return 'urgent';    // ê¸´ê¸‰ (ë¹¨ê°•)
      if (hoursLeft < 24) return 'warning';  // ì£¼ì˜ (ì£¼í™©)
      return 'normal';                       // ì¼ë°˜
    }

    // ============================================
    // ëª¨ë“œ ë° í•„í„°ë§
    // ============================================
    
    /**
     * í˜„ì¬ ì‹œê°„ëŒ€ ê¸°ë°˜ ëª¨ë“œ ê²°ì •
     */
    function getCurrentMode() {
      const hour = new Date().getHours();
      
      if (hour >= 11 && hour < 20) return 'íšŒì‚¬';
      if (appState.shuttleSuccess && hour >= 19 && hour < 24) return 'ì—¬ìœ ';
      if (!appState.shuttleSuccess && hour >= 22 && hour < 24) return 'ìƒì¡´';
      if (hour >= 7 && hour < 11) return 'ì¶œê·¼';
      return 'íœ´ì‹';
    }

    /**
     * í˜„ì¬ ëª¨ë“œì— ë§ê²Œ ì‘ì—… í•„í„°ë§ ë° ì •ë ¬
     */
    function getFilteredTasks() {
      const mode = getCurrentMode();
      let filtered = appState.tasks.filter(t => !t.completed);
      
      // ìš°ì„ ìˆœìœ„ì™€ ê¸´ê¸‰ë„ ê³„ì‚°
      filtered = filtered.map(t => ({
        ...t,
        priority: calculatePriority(t),
        urgency: getUrgencyLevel(t)
      }));
      
      // ìš°ì„ ìˆœìœ„ ê¸°ì¤€ ì •ë ¬ (ë†’ì€ ìˆœ)
      filtered.sort((a, b) => b.priority - a.priority);
      
      // ëª¨ë“œë³„ í•„í„°ë§
      if (mode === 'íšŒì‚¬') {
        filtered = filtered.filter(t => t.category === 'ë³¸ì—…');
      } else if (mode === 'ìƒì¡´') {
        // ìƒì¡´ ëª¨ë“œ: ì§§ê³  ê¸´ê¸‰í•œ ê²ƒë§Œ
        filtered = filtered.filter(t => t.estimatedTime <= 15 || t.priority > 90);
      }
      
      return filtered;
    }

    /**
     * ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ê³„ì‚°
     */
    function getCategoryStats() {
      const categories = ['ë³¸ì—…', 'ë¶€ì—…', 'ì¼ìƒ'];
      return categories.map(cat => {
        const allTasks = appState.tasks.filter(t => t.category === cat);
        const completed = allTasks.filter(t => t.completed).length;
        const total = allTasks.length;
        const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
        return { 
          category: cat, 
          total: total - completed,  // ë‚¨ì€ ì‘ì—…
          completed, 
          percentage 
        };
      });
    }

    /**
     * ê¸´ê¸‰ ì‘ì—… ëª©ë¡ ë°˜í™˜
     */
    function getUrgentTasks() {
      return appState.tasks
        .filter(t => !t.completed && t.deadline)
        .map(t => ({
          ...t,
          urgency: getUrgencyLevel(t)
        }))
        .filter(t => t.urgency === 'urgent' || t.urgency === 'warning')
        .sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
    }

    // ============================================
    // ì‚¬ìš©ì ì•¡ì…˜ í•¸ë“¤ëŸ¬
    // ============================================
    
    /**
     * íƒ­ ì „í™˜
     */
    function switchTab(tab) {
      appState.currentTab = tab;
      renderStatic();
    }

    /**
     * ì…”í‹€ ìƒíƒœ í† ê¸€
     */
    function toggleShuttle() {
      appState.shuttleSuccess = !appState.shuttleSuccess;
      saveState();
      renderStatic();
    }

    /**
     * ë¹ ë¥¸ ì¶”ê°€ (ì œëª©ë§Œ ì…ë ¥)
     */
    function quickAdd() {
      const title = appState.quickAddValue.trim();
      if (!title) {
        showToast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }
      
      appState.tasks.push({
        id: Date.now(),
        title: title,
        category: 'ë¶€ì—…',
        deadline: '',
        estimatedTime: 10,
        link: '',
        expectedRevenue: '',
        completed: false,
        createdAt: new Date().toISOString()
      });
      
      appState.quickAddValue = '';
      const input = document.getElementById('quick-add-input');
      if (input) input.value = '';
      
      saveState();
      renderStatic();
      showToast('ì‘ì—…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      
      if (navigator.vibrate) {
        navigator.vibrate(50);
      }
    }

    /**
     * ìƒì„¸ ì¶”ê°€/ìˆ˜ì •
     */
    function detailedAdd() {
      const task = appState.detailedTask;
      if (!task.title) {
        showToast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
        return;
      }
      
      if (appState.editingTaskId) {
        // ìˆ˜ì • ëª¨ë“œ
        appState.tasks = appState.tasks.map(t => 
          t.id === appState.editingTaskId 
            ? { ...task, id: t.id, completed: t.completed, createdAt: t.createdAt }
            : t
        );
        showToast('ì‘ì—…ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } else {
        // ì¶”ê°€ ëª¨ë“œ
        appState.tasks.push({
          id: Date.now(),
          ...task,
          completed: false,
          createdAt: new Date().toISOString()
        });
        showToast('ì‘ì—…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      }
      
      // í¼ ì´ˆê¸°í™”
      appState.detailedTask = {
        title: '',
        category: 'ë¶€ì—…',
        deadline: '',
        estimatedTime: 10,
        link: '',
        expectedRevenue: ''
      };
      appState.showDetailedAdd = false;
      appState.editingTaskId = null;
      
      saveState();
      renderStatic();
      
      if (navigator.vibrate) {
        navigator.vibrate(50);
      }
    }

    /**
     * ì‘ì—… ì™„ë£Œ
     */
    function completeTask(id) {
      appState.tasks = appState.tasks.map(t => 
        t.id === id ? { ...t, completed: true } : t
      );
      saveState();
      renderStatic();
      showToast('ì™„ë£Œ!', 'success');
      
      if (navigator.vibrate) {
        navigator.vibrate([50, 100, 50]);
      }
    }

    /**
     * ì‘ì—… ì™„ë£Œ ì·¨ì†Œ
     */
    function uncompleteTask(id) {
      appState.tasks = appState.tasks.map(t => 
        t.id === id ? { ...t, completed: false } : t
      );
      saveState();
      renderStatic();
      showToast('ì™„ë£Œ ì·¨ì†Œ', 'success');
    }

    /**
     * ì‘ì—… ìˆ˜ì • ëª¨ë“œ ì§„ì…
     */
    function editTask(id) {
      const task = appState.tasks.find(t => t.id === id);
      if (!task) return;
      
      appState.detailedTask = { ...task };
      appState.showDetailedAdd = true;
      appState.editingTaskId = id;
      appState.currentTab = 'action'; // ì‹¤í–‰ íƒ­ìœ¼ë¡œ ì´ë™
      renderStatic();
      
      // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤
      setTimeout(() => {
        const formEl = document.querySelector('.add-task-section');
        if (formEl) {
          formEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }, 100);
    }

    /**
     * ìˆ˜ì • ì·¨ì†Œ
     */
    function cancelEdit() {
      appState.detailedTask = {
        title: '',
        category: 'ë¶€ì—…',
        deadline: '',
        estimatedTime: 10,
        link: '',
        expectedRevenue: ''
      };
      appState.showDetailedAdd = false;
      appState.editingTaskId = null;
      renderStatic();
    }

    /**
     * ì‘ì—… ì‚­ì œ
     */
    function deleteTask(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      appState.tasks = appState.tasks.filter(t => t.id !== id);
      saveState();
      renderStatic();
      showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
    }

    /**
     * ë§í¬ ì—´ê¸°
     */
    function handleGo(link) {
      if (link) {
        window.open(link, '_blank');
      }
    }

    /**
     * ì‘ì—… ë¦¬ìŠ¤íŠ¸ í† ê¸€
     */
    function toggleTaskList() {
      appState.showTaskList = !appState.showTaskList;
      renderStatic();
    }

    /**
     * ì™„ë£Œëœ ì‘ì—… ë³´ê¸° í† ê¸€
     */
    function toggleCompletedTasks() {
      appState.showCompletedTasks = !appState.showCompletedTasks;
      renderStatic();
    }

    /**
     * ìƒì„¸ ì¶”ê°€ í¼ í† ê¸€
     */
    function toggleDetailedAdd() {
      appState.showDetailedAdd = !appState.showDetailedAdd;
      
      // ìˆ˜ì • ì¤‘ì´ì—ˆìœ¼ë©´ ì·¨ì†Œ
      if (!appState.showDetailedAdd && appState.editingTaskId) {
        cancelEdit();
        return;
      }
      
      renderStatic();
    }

    /**
     * ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ í˜¸ì¶œ
     */
    function updateDetailedTaskCategory(category) {
      appState.detailedTask.category = category;
      renderStatic();
    }

    // ============================================
    // ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜
    // ============================================
    
    function handleTouchStart(e, taskId) {
      appState.touchStart = {
        x: e.touches[0].clientX,
        taskId: taskId
      };
      appState.touchingTaskId = taskId;
    }

    function handleTouchMove(e, taskId) {
      if (!appState.touchStart || appState.touchStart.taskId !== taskId) return;
      
      const deltaX = e.touches[0].clientX - appState.touchStart.x;
      const taskEl = document.getElementById(`task-${taskId}`);
      
      if (Math.abs(deltaX) > 30) {
        if (deltaX < 0) {
          taskEl.classList.add('swiping-left');
          taskEl.classList.remove('swiping-right');
        } else {
          taskEl.classList.add('swiping-right');
          taskEl.classList.remove('swiping-left');
        }
      }
    }

    function handleTouchEnd(e, taskId) {
      if (!appState.touchStart || appState.touchStart.taskId !== taskId) return;
      
      const deltaX = e.changedTouches[0].clientX - appState.touchStart.x;
      const taskEl = document.getElementById(`task-${taskId}`);
      
      if (deltaX < -100) {
        completeTask(taskId);
      } else if (deltaX > 100) {
        deleteTask(taskId);
      }
      
      if (taskEl) {
        taskEl.classList.remove('swiping-left', 'swiping-right');
      }
      appState.touchStart = null;
      appState.touchingTaskId = null;
    }

    // ============================================
    // ë°±ì—…/ë³µì›
    // ============================================
    
    /**
     * JSONìœ¼ë¡œ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
     */
    function exportData() {
      try {
        const data = {
          version: '1.0',
          exportDate: new Date().toISOString(),
          tasks: appState.tasks,
          shuttleSuccess: appState.shuttleSuccess
        };
        
        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `navigator-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        
        URL.revokeObjectURL(url);
        showToast('ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      } catch (error) {
        console.error('ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
        showToast('ë°±ì—… ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }

    /**
     * JSONì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
     */
    function importData() {
      const input = document.getElementById('file-import');
      input.click();
    }

    /**
     * íŒŒì¼ ì„ íƒ ì‹œ ì²˜ë¦¬
     */
    function handleFileImport(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const data = JSON.parse(event.target.result);
          
          // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
          if (!data.tasks || !Array.isArray(data.tasks)) {
            throw new Error('ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤');
          }
          
          // ë°ì´í„° ë³µì›
          if (confirm('í˜„ì¬ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            appState.tasks = data.tasks;
            appState.shuttleSuccess = data.shuttleSuccess || false;
            saveState();
            renderStatic();
            showToast('ë°ì´í„°ë¥¼ ë³µì›í–ˆìŠµë‹ˆë‹¤', 'success');
          }
        } catch (error) {
          console.error('ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
          showToast('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
        }
      };
      reader.readAsText(file);
      
      // ì¸í’‹ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ)
      e.target.value = '';
    }

    // ============================================
    // UI í—¬í¼
    // ============================================
    
    /**
     * í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
     */
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 2000);
    }

    /**
     * ë§ˆê°ì‹œê°„ í¬ë§·íŒ…
     */
    function formatDeadline(deadline) {
      const now = new Date();
      const d = new Date(deadline);
      const hoursLeft = (d - now) / (1000 * 60 * 60);
      
      if (hoursLeft < 1) {
        return `${Math.round(hoursLeft * 60)}ë¶„ í›„`;
      } else if (hoursLeft < 24) {
        return `${Math.round(hoursLeft)}ì‹œê°„ í›„`;
      }
      
      return d.toLocaleString('ko-KR', {
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // ============================================
    // ë Œë”ë§
    // ============================================
    
    /**
     * ì „ì²´ í™”ë©´ ë Œë”ë§ (ìƒíƒœ ë³€ê²½ ì‹œ í˜¸ì¶œ)
     */
    function renderStatic() {
      const now = new Date();
      const hour = now.getHours();
      const filteredTasks = getFilteredTasks();
      const nextAction = filteredTasks[0] || null;
      const mode = getCurrentMode();
      const categoryStats = getCategoryStats();
      const urgentTasks = getUrgentTasks();
      
      const stats = {
        total: appState.tasks.length,
        completed: appState.tasks.filter(t => t.completed).length,
        remaining: appState.tasks.filter(t => !t.completed).length
      };
      
      const completedTasks = appState.tasks.filter(t => t.completed);
      const hiddenCount = appState.tasks.filter(t => !t.completed).length - filteredTasks.length;
      
      const bedtime = new Date(now);
      bedtime.setHours(24, 0, 0, 0);
      const minutesUntilBed = Math.floor((bedtime - now) / (1000 * 60));
      
      const urgencyClass = nextAction ? nextAction.urgency : 'normal';
      const urgencyLabel = {
        'urgent': 'ğŸš¨ ê¸´ê¸‰!',
        'warning': 'âš ï¸ ì£¼ì˜',
        'normal': 'â–¶ ì§€ê¸ˆ í•  ê²ƒ',
        'expired': 'âŒ ë§ˆê° ì§€ë‚¨'
      };

      // ì¹´í…Œê³ ë¦¬ë³„ ì…ë ¥ í•„ë“œ
      const categoryFields = {
        'ë³¸ì—…': `
          <div class="form-group">
            <label class="form-label">ë§ˆê°ì‹œê°„</label>
            <input type="datetime-local" class="form-input" id="detailed-deadline" value="${appState.detailedTask.deadline}">
          </div>
          <div class="form-group">
            <label class="form-label">ì˜ˆìƒ ì†Œìš”ì‹œê°„ (ë¶„)</label>
            <input type="number" class="form-input" id="detailed-time" value="${appState.detailedTask.estimatedTime}">
          </div>
          <div class="form-group">
            <label class="form-label">ë§í¬</label>
            <input type="url" class="form-input" id="detailed-link" placeholder="https://" value="${appState.detailedTask.link}">
          </div>
        `,
        'ë¶€ì—…': `
          <div class="form-group">
            <label class="form-label">ë§ˆê°ì‹œê°„</label>
            <input type="datetime-local" class="form-input" id="detailed-deadline" value="${appState.detailedTask.deadline}">
          </div>
          <div class="form-group">
            <label class="form-label">ì˜ˆìƒ ì†Œìš”ì‹œê°„ (ë¶„)</label>
            <input type="number" class="form-input" id="detailed-time" value="${appState.detailedTask.estimatedTime}">
          </div>
          <div class="form-group">
            <label class="form-label">ì˜ˆìƒ ìˆ˜ìµ (ì›, ì„ íƒì‚¬í•­)</label>
            <input type="number" class="form-input" id="detailed-revenue" placeholder="ëª¨ë¥¼ ê²½ìš° ë¹„ì›Œë‘ì„¸ìš”" value="${appState.detailedTask.expectedRevenue}">
            <div class="form-note">* ìˆ˜ìµì„ ëª¨ë¥´ëŠ” ê²½ìš° ë¹„ì›Œë‘ì…”ë„ ë©ë‹ˆë‹¤</div>
          </div>
          <div class="form-group">
            <label class="form-label">ë§í¬</label>
            <input type="url" class="form-input" id="detailed-link" placeholder="https://" value="${appState.detailedTask.link}">
          </div>
        `,
        'ì¼ìƒ': `
          <div class="form-group">
            <label class="form-label">ì˜ˆìƒ ì†Œìš”ì‹œê°„ (ë¶„)</label>
            <input type="number" class="form-input" id="detailed-time" value="${appState.detailedTask.estimatedTime}">
          </div>
        `
      };

      document.getElementById('root').innerHTML = `
        <div class="app">
          <div class="header">
            <h1>âš¡ Navigator</h1>
            <p>ìƒì¡´í˜• í• ì¼ ê´€ë¦¬</p>
          </div>

          <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
          <div class="tab-nav">
            <button class="tab-btn ${appState.currentTab === 'action' ? 'active' : ''}" onclick="switchTab('action')">
              â–¶ ì‹¤í–‰
            </button>
            <button class="tab-btn ${appState.currentTab === 'dashboard' ? 'active' : ''}" onclick="switchTab('dashboard')">
              ğŸ“Š ëŒ€ì‹œë³´ë“œ
            </button>
          </div>

          <!-- ì‹¤í–‰ íƒ­ -->
          <div class="tab-content ${appState.currentTab === 'action' ? 'active' : ''}">
            <div class="shuttle-status ${!appState.shuttleSuccess ? 'failed' : ''}" onclick="toggleShuttle()">
              <div class="shuttle-icon">${appState.shuttleSuccess ? 'ğŸšŒ' : 'ğŸ˜´'}</div>
              <div class="shuttle-title">${appState.shuttleSuccess ? 'ì…”í‹€ íƒ‘ìŠ¹ ì„±ê³µ!' : 'ì…”í‹€ ë†“ì¹¨'}</div>
              <div class="shuttle-desc">${appState.shuttleSuccess ? 'ì˜¤ëŠ˜ ë³´ë„ˆìŠ¤ ì‹œê°„ í™•ë³´' : 'ìƒì¡´ ëª¨ë“œ ê°€ë™'}</div>
            </div>

            <div class="mode-indicator">
              í˜„ì¬ ëª¨ë“œ: <strong>${mode}</strong>
              ${mode === 'íšŒì‚¬' ? ' (ë³¸ì—…ë§Œ í‘œì‹œ)' : ''}
              ${mode === 'ìƒì¡´' ? ' (ê¸´ê¸‰/ì§§ì€ ê²ƒë§Œ)' : ''}
            </div>

            ${hour >= 22 ? `
              <div class="time-remaining ${minutesUntilBed < 60 ? 'panic' : ''}">
                <div class="time-label">ì·¨ì¹¨ê¹Œì§€</div>
                <div class="time-value" id="time-value">${Math.floor(minutesUntilBed / 60)}ì‹œê°„ ${minutesUntilBed % 60}ë¶„</div>
                ${minutesUntilBed < 60 ? '<div class="time-warning">âš ï¸ ì§€ê¸ˆ ìì•¼ 07:00 ê¸°ìƒ ê°€ëŠ¥</div>' : ''}
              </div>
            ` : ''}

            <div class="stats">
              <div class="stat-card">
                <div class="stat-value">${stats.total}</div>
                <div class="stat-label">ì „ì²´</div>
              </div>
              <div class="stat-card" onclick="toggleCompletedTasks()" style="cursor: pointer;">
                <div class="stat-value" style="color: #48bb78">${stats.completed}</div>
                <div class="stat-label">ì™„ë£Œ (í´ë¦­)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" style="color: #f093fb">${stats.remaining}</div>
                <div class="stat-label">ë‚¨ìŒ</div>
              </div>
            </div>

            <!-- ë°ì´í„° ë°±ì—…/ë³µì› -->
            <div class="backup-section">
              <div class="backup-title">ğŸ’¾ ë°ì´í„° ë°±ì—…</div>
              <div class="backup-buttons">
                <button class="backup-btn export" onclick="exportData()">ğŸ“¥ ë‚´ë³´ë‚´ê¸°</button>
                <button class="backup-btn import" onclick="importData()">ğŸ“¤ ê°€ì ¸ì˜¤ê¸°</button>
              </div>
            </div>

            <div class="quick-add">
              <div class="quick-add-header">âš¡ ë¹ ë¥¸ ì¶”ê°€</div>
              <div class="quick-add-input-group">
                <input 
                  type="text" 
                  id="quick-add-input"
                  class="quick-add-input" 
                  placeholder="ì‘ì—… ì œëª© ì…ë ¥ í›„ Enter"
                  value="${appState.quickAddValue}"
                  onkeypress="if(event.key==='Enter') quickAdd()"
                >
                <button class="quick-add-btn" onclick="quickAdd()">+</button>
              </div>
              <div class="quick-add-toggle" onclick="toggleDetailedAdd()">
                ${appState.showDetailedAdd ? 'â–² ìƒì„¸ ì˜µì…˜ ìˆ¨ê¸°ê¸°' : 'â–¼ ìƒì„¸ ì˜µì…˜ í¼ì¹˜ê¸°'}
              </div>
            </div>

            ${appState.showDetailedAdd ? `
              <div class="add-task-section">
                <h3>${appState.editingTaskId ? 'âœï¸ ì‘ì—… ìˆ˜ì •' : 'â• ìƒì„¸ ì…ë ¥'}</h3>
                <div class="form-group">
                  <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                  <select class="form-select" id="detailed-category" onchange="updateDetailedTaskCategory(this.value)">
                    <option value="ë³¸ì—…" ${appState.detailedTask.category === 'ë³¸ì—…' ? 'selected' : ''}>ë³¸ì—…</option>
                    <option value="ë¶€ì—…" ${appState.detailedTask.category === 'ë¶€ì—…' ? 'selected' : ''}>ë¶€ì—…</option>
                    <option value="ì¼ìƒ" ${appState.detailedTask.category === 'ì¼ìƒ' ? 'selected' : ''}>ì¼ìƒ</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">ì œëª©</label>
                  <input type="text" class="form-input" id="detailed-title" placeholder="ì‘ì—… ì œëª©" value="${appState.detailedTask.title}">
                </div>
                ${categoryFields[appState.detailedTask.category]}
                ${appState.editingTaskId ? `
                  <button class="btn btn-primary" onclick="detailedAdd()">âœ“ ìˆ˜ì • ì™„ë£Œ</button>
                  <button class="btn btn-secondary" onclick="cancelEdit()">âœ• ì·¨ì†Œ</button>
                ` : `
                  <button class="btn btn-primary" onclick="detailedAdd()">ì¶”ê°€í•˜ê¸°</button>
                `}
              </div>
            ` : ''}

            ${nextAction ? `
              <div class="next-action ${urgencyClass}">
                <div class="next-action-label">${urgencyLabel[urgencyClass]}</div>
                <div class="task-title">${nextAction.title}</div>
                <div class="task-meta">
                  <span class="category ${nextAction.category}">${nextAction.category}</span>
                  ${nextAction.estimatedTime ? `<span class="meta-item">â± ${nextAction.estimatedTime}ë¶„</span>` : ''}
                  ${nextAction.deadline ? `<span class="meta-item">â° ${formatDeadline(nextAction.deadline)}</span>` : ''}
                  ${nextAction.expectedRevenue ? `<span class="meta-item">ğŸ’° ${parseInt(nextAction.expectedRevenue).toLocaleString()}ì›</span>` : ''}
                </div>
                <button class="btn btn-primary" onclick="handleGo('${nextAction.link || ''}')">
                  ${nextAction.link ? 'ğŸš€ GO' : 'ì‹œì‘í•˜ê¸°'}
                </button>
                <button class="btn btn-success" onclick="completeTask(${nextAction.id})">
                  âœ“ ì™„ë£Œ
                </button>
              </div>
            ` : `
              <div class="next-action">
                <div class="next-action-label">âœ¨ ëª¨ë“  ì‘ì—… ì™„ë£Œ!</div>
                <div class="task-title">ì˜í•˜ì…¨ìŠµë‹ˆë‹¤</div>
                <div style="font-size: 14px; color: #999; margin-top: 10px">
                  ìƒˆë¡œìš´ ì‘ì—…ì„ ì¶”ê°€í•˜ê±°ë‚˜ íœ´ì‹í•˜ì„¸ìš”
                </div>
              </div>
            `}

            ${hiddenCount > 0 ? `
              <div class="hidden-tasks">
                ì˜¤ëŠ˜ ëª» í•  ê²ƒ ${hiddenCount}ê°œ ìˆ¨ê¹€<br>
                <span style="font-size: 12px">ë‚´ì¼ í•˜ë©´ ë©ë‹ˆë‹¤</span>
              </div>
            ` : ''}

            ${filteredTasks.length > 0 ? `
              <div class="task-list-section">
                <div class="task-list-header" onclick="toggleTaskList()">
                  <div class="task-list-title">ğŸ“‹ ì „ì²´ ëª©ë¡</div>
                  <div class="task-list-count">${filteredTasks.length}ê°œ ${appState.showTaskList ? 'â–¼' : 'â–¶'}</div>
                </div>
                <div class="task-list ${appState.showTaskList ? 'show' : ''}">
                  ${filteredTasks.map((task, index) => `
                    <div 
                      id="task-${task.id}"
                      class="task-item ${task.urgency === 'urgent' ? 'urgent' : ''} ${task.urgency === 'warning' ? 'warning' : ''}"
                      ontouchstart="handleTouchStart(event, ${task.id})"
                      ontouchmove="handleTouchMove(event, ${task.id})"
                      ontouchend="handleTouchEnd(event, ${task.id})"
                    >
                      <div class="swipe-actions left">âœ“ ì™„ë£Œ</div>
                      <div class="swipe-actions right">Ã— ì‚­ì œ</div>
                      
                      <div class="task-item-header">
                        <div class="task-item-title">${index + 1}. ${task.title}</div>
                      </div>
                      <div class="task-item-meta">
                        <span class="category ${task.category}">${task.category}</span>
                        ${task.estimatedTime ? ` Â· ${task.estimatedTime}ë¶„` : ''}
                        ${task.deadline ? ` Â· ${formatDeadline(task.deadline)}` : ''}
                        ${task.priority ? ` Â· ì ìˆ˜: ${Math.round(task.priority)}` : ''}
                      </div>
                      <div class="task-item-actions">
                        ${task.link ? `<button class="btn-small go" onclick="handleGo('${task.link}')">GO</button>` : ''}
                        <button class="btn-small complete" onclick="completeTask(${task.id})">âœ“</button>
                        <button class="btn-small edit" onclick="editTask(${task.id})">âœï¸</button>
                        <button class="btn-small delete" onclick="deleteTask(${task.id})">Ã—</button>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}

            ${appState.showCompletedTasks && completedTasks.length > 0 ? `
              <div class="task-list-section">
                <div class="task-list-header" onclick="toggleCompletedTasks()">
                  <div class="task-list-title">âœ“ ì™„ë£Œí•œ ì‘ì—…</div>
                  <div class="task-list-count">${completedTasks.length}ê°œ ${appState.showCompletedTasks ? 'â–¼' : 'â–¶'}</div>
                </div>
                <div class="task-list show">
                  ${completedTasks.map((task, index) => `
                    <div id="task-completed-${task.id}" class="task-item completed">
                      <div class="task-item-header">
                        <div class="task-item-title completed">${index + 1}. ${task.title}</div>
                      </div>
                      <div class="task-item-meta">
                        <span class="category ${task.category}">${task.category}</span>
                        ${task.estimatedTime ? ` Â· ${task.estimatedTime}ë¶„` : ''}
                      </div>
                      <div class="task-item-actions">
                        <button class="btn-small uncomplete" onclick="uncompleteTask(${task.id})">â†©ï¸ ë˜ëŒë¦¬ê¸°</button>
                        <button class="btn-small delete" onclick="deleteTask(${task.id})">Ã— ì‚­ì œ</button>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}

            ${appState.tasks.length === 0 ? `
              <div class="empty-state">
                <div class="empty-state-icon">ğŸ“‹</div>
                <div>ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>
                <div style="font-size: 14px; margin-top: 10px">ìƒˆ ì‘ì—…ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</div>
              </div>
            ` : ''}
          </div>

          <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
          <div class="tab-content ${appState.currentTab === 'dashboard' ? 'active' : ''}">
            <div class="dashboard-section">
              <div class="dashboard-title">ğŸ“ˆ ì˜¤ëŠ˜ ìš”ì•½</div>
              <div class="stats">
                <div class="stat-card">
                  <div class="stat-value">${stats.total}</div>
                  <div class="stat-label">ì „ì²´ ì‘ì—…</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value" style="color: #48bb78">${stats.completed}</div>
                  <div class="stat-label">ì™„ë£Œ</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value">${stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0}%</div>
                  <div class="stat-label">ì™„ë£Œìœ¨</div>
                </div>
              </div>
            </div>

            <div class="dashboard-section">
              <div class="dashboard-title">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ í˜„í™©</div>
              <div class="category-stats">
                ${categoryStats.map(stat => `
                  <div class="category-stat">
                    <div class="category-stat-header">
                      <span class="category ${stat.category}">${stat.category}</span>
                      <span class="category-progress">${stat.completed}/${stat.total + stat.completed} ì™„ë£Œ</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill ${stat.category}" style="width: ${stat.percentage}%"></div>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>

            ${urgentTasks.length > 0 ? `
              <div class="dashboard-section">
                <div class="dashboard-title">ğŸš¨ ë§ˆê° ì„ë°•</div>
                <div class="urgent-list">
                  ${urgentTasks.slice(0, 5).map(task => `
                    <div class="urgent-item">
                      <div class="urgent-item-title">${task.title}</div>
                      <div class="urgent-item-time">â° ${formatDeadline(task.deadline)}</div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}

            <div class="dashboard-section">
              <div class="dashboard-title">ğŸ“‹ ì „ì²´ ì‘ì—… ëª©ë¡</div>
              ${appState.tasks.filter(t => !t.completed).length > 0 ? `
                <div class="task-list show">
                  ${appState.tasks.filter(t => !t.completed).map((task, index) => {
                    const urgency = getUrgencyLevel(task);
                    return `
                    <div 
                      id="task-dash-${task.id}"
                      class="task-item ${urgency === 'urgent' ? 'urgent' : ''} ${urgency === 'warning' ? 'warning' : ''}"
                    >
                      <div class="task-item-header">
                        <div class="task-item-title">${index + 1}. ${task.title}</div>
                      </div>
                      <div class="task-item-meta">
                        <span class="category ${task.category}">${task.category}</span>
                        ${task.estimatedTime ? ` Â· ${task.estimatedTime}ë¶„` : ''}
                        ${task.deadline ? ` Â· ${formatDeadline(task.deadline)}` : ''}
                      </div>
                      <div class="task-item-actions">
                        ${task.link ? `<button class="btn-small go" onclick="handleGo('${task.link}')">GO</button>` : ''}
                        <button class="btn-small complete" onclick="completeTask(${task.id})">âœ“</button>
                        <button class="btn-small edit" onclick="editTask(${task.id})">âœï¸</button>
                        <button class="btn-small delete" onclick="deleteTask(${task.id})">Ã—</button>
                      </div>
                    </div>
                  `}).join('')}
                </div>
              ` : `
                <div class="empty-state">
                  <div class="empty-state-icon">âœ¨</div>
                  <div>ëª¨ë“  ì‘ì—… ì™„ë£Œ!</div>
                </div>
              `}
            </div>

            ${completedTasks.length > 0 ? `
              <div class="dashboard-section">
                <div class="dashboard-title">âœ… ì™„ë£Œí•œ ì‘ì—… (${completedTasks.length}ê°œ)</div>
                <div class="task-list show">
                  ${completedTasks.slice(0, 10).map((task, index) => `
                    <div class="task-item completed">
                      <div class="task-item-header">
                        <div class="task-item-title completed">${index + 1}. ${task.title}</div>
                      </div>
                      <div class="task-item-meta">
                        <span class="category ${task.category}">${task.category}</span>
                      </div>
                      <div class="task-item-actions">
                        <button class="btn-small uncomplete" onclick="uncompleteTask(${task.id})">â†©ï¸</button>
                        <button class="btn-small delete" onclick="deleteTask(${task.id})">Ã—</button>
                      </div>
                    </div>
                  `).join('')}
                </div>
                ${completedTasks.length > 10 ? `
                  <div style="text-align: center; margin-top: 10px; color: #999; font-size: 14px;">
                    ìµœê·¼ 10ê°œë§Œ í‘œì‹œ (ì „ì²´ ${completedTasks.length}ê°œ)
                  </div>
                ` : ''}
              </div>
            ` : ''}
          </div>
        </div>
      `;

      // ì…ë ¥ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
      setupInputHandlers();
    }

    /**
     * ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
     */
    function setupInputHandlers() {
      const quickInput = document.getElementById('quick-add-input');
      if (quickInput) {
        quickInput.oninput = (e) => {
          appState.quickAddValue = e.target.value;
        };
      }

      if (appState.showDetailedAdd) {
        const inputs = {
          title: document.getElementById('detailed-title'),
          deadline: document.getElementById('detailed-deadline'),
          time: document.getElementById('detailed-time'),
          revenue: document.getElementById('detailed-revenue'),
          link: document.getElementById('detailed-link')
        };

        if (inputs.title) inputs.title.oninput = (e) => appState.detailedTask.title = e.target.value;
        if (inputs.deadline) inputs.deadline.onchange = (e) => appState.detailedTask.deadline = e.target.value;
        if (inputs.time) inputs.time.oninput = (e) => appState.detailedTask.estimatedTime = parseInt(e.target.value) || 0;
        if (inputs.revenue) inputs.revenue.oninput = (e) => appState.detailedTask.expectedRevenue = e.target.value;
        if (inputs.link) inputs.link.oninput = (e) => appState.detailedTask.link = e.target.value;
      }

      // íŒŒì¼ ì„í¬íŠ¸ í•¸ë“¤ëŸ¬
      const fileInput = document.getElementById('file-import');
      if (fileInput) {
        fileInput.onchange = handleFileImport;
      }
    }

    /**
     * ì‹œê°„ë§Œ ì—…ë°ì´íŠ¸ (1ì´ˆë§ˆë‹¤)
     */
    function updateTime() {
      const now = new Date();
      const bedtime = new Date(now);
      bedtime.setHours(24, 0, 0, 0);
      const minutesUntilBed = Math.floor((bedtime - now) / (1000 * 60));
      
      const timeEl = document.getElementById('time-value');
      if (timeEl) {
        timeEl.textContent = `${Math.floor(minutesUntilBed / 60)}ì‹œê°„ ${minutesUntilBed % 60}ë¶„`;
      }
    }

    // ============================================
    // ì „ì—­ í•¨ìˆ˜ ë“±ë¡ (HTMLì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ê²Œ)
    // ============================================
    window.switchTab = switchTab;
    window.toggleShuttle = toggleShuttle;
    window.quickAdd = quickAdd;
    window.detailedAdd = detailedAdd;
    window.completeTask = completeTask;
    window.uncompleteTask = uncompleteTask;
    window.editTask = editTask;
    window.cancelEdit = cancelEdit;
    window.deleteTask = deleteTask;
    window.handleGo = handleGo;
    window.toggleTaskList = toggleTaskList;
    window.toggleCompletedTasks = toggleCompletedTasks;
    window.toggleDetailedAdd = toggleDetailedAdd;
    window.updateDetailedTaskCategory = updateDetailedTaskCategory;
    window.handleTouchStart = handleTouchStart;
    window.handleTouchMove = handleTouchMove;
    window.handleTouchEnd = handleTouchEnd;
    window.exportData = exportData;
    window.importData = importData;

    // ============================================
    // ì•± ì´ˆê¸°í™”
    // ============================================
    loadState();
    renderStatic();
    setInterval(updateTime, 1000);
  </script>
</body>
</html>
