# Navigator - ADHD 친화적 할일 관리

## 📋 프로젝트
- **이름**: Navigator
- **스택**: HTML + Vanilla JS + Firebase (Auth/Firestore)
- **한 줄 설명**: ADHD 친화적 할일 관리, 예상 수익 추적, 시간 관리

---

## 🚨 절대 규칙 (위반 시 작업 중단)

**무조건 멈추고 확인:**
1. 파일/함수/컬럼 삭제
2. 3개 이상 파일 동시 수정
3. export 되는 함수/변수 이름 변경
4. DB 스키마 변경
5. 의존성 추가/제거

**절대 금지:**
- UI만 만들고 DB 연결 안 하기
- 확인 없이 작동하던 코드 덮어쓰기
- 같은 에러에 같은 방법 3회 이상 반복
- any 타입으로 도피

---

## 🧠 능동적 작업 원칙 (시키는 것 이상으로)

> **핵심: 명령 받은 것만 고치는 게 아니라, 같은 문제가 있는 곳을 찾아서 함께 고치고, 예상되는 문제를 미리 막는다.**

### 1. 유사 패턴 전수 수정
- 한 곳을 고치면, **동일한 패턴이 존재하는 다른 곳을 전체 검색**하여 함께 수정
- 수정 전 발견된 전체 목록을 먼저 보여주고 진행
- 형식:
  ```
  🔎 동일 패턴 발견: [N]곳
  1. [파일:라인] — [코드 요약]
  2. ...
  함께 수정할까요?
  ```

### 2. 사이드이펙트 예측 & 선제 제안
- 코드 수정 시 **깨질 수 있는 것, 영향받는 기능을 먼저 분석하고 제안**
- 단순히 "영향 있음"이 아니라 **구체적 시나리오 + 해결 방안**을 함께 제시
- 형식:
  ```
  ⚠️ 예상 사이드이펙트:
  1. [시나리오] → [해결 방안] (지금 같이 처리 추천)
  2. [시나리오] → [해결 방안] (나중에 해도 됨)

  바로 반영할까요?
  ```

### 3. 난이도 판단 → Ralph Loop 제안
아래 조건에 해당하면 `/ralph-loop` 사용을 **먼저 제안**:
- 수정 대상이 **10곳 이상** 흩어져 있는 배치 작업
- **반복적 패턴 수정** (전수 치환, 일괄 리팩토링)
- 한 번에 끝내기 어려운 **다단계 구현**
- 형식:
  ```
  🔄 난이도 높은 작업 감지
  - 예상 수정: [N]곳 / [N]단계
  - 추천: `/ralph-loop "[작업 설명]" --max 10`
  - 이유: [왜 반복 루프가 적합한지]

  Ralph로 진행할까요, 수동으로 할까요?
  ```

### 4. 선제적 품질 개선
작업 중 발견한 아래 문제는 **물어보지 않고 바로 보고** (수정은 확인 후):
- 보안 취약점 (XSS, 인젝션, 노출된 키)
- 명백한 버그 (null 참조, 오타, 로직 오류)
- 성능 문제 (무한 루프 가능성, 불필요한 리렌더링)
- 접근성 누락 (aria-label 없는 버튼, 포커스 트랩 누락)

---

## 🎯 구현 완결성 (모든 기능 적용)

**기능 = UI + 로직 + DB + 피드백 + 조회**

### 구현 전 체크
```
□ DB 스키마/컬럼 존재? (없으면 먼저 추가)
□ 타입 정의 업데이트 필요?
□ 에러 핸들링 계획?
□ 동일 패턴 다른 곳에도 있는지 전수 검색했는가?
□ 사이드이펙트 분석했는가?
```

### 구현 후 자기검증
```
□ 저장 → DB 반영 확인
□ 새로고침 → 데이터 유지
□ 에러 상황 → 사용자 피드백
□ 동일 패턴 필요한 다른 곳 → 전수 검색 후 함께 수정 제안
□ 사이드이펙트 → 예측한 문제 발생하지 않는지 확인
```

---

## 🔍 변경 전 영향도 분석 (필수)

코드 수정 전 먼저 분석 후 공유:

```
📍 영향 범위:
- 수정: [파일 목록]
- 영향: [이 변경으로 깨질 수 있는 것]
- DB: [스키마 변경 필요 여부]

⚠️ Edge Cases:
- [null/undefined 가능성]
- [에러 상황]
```

---

## 📋 플랜 형식

```
📋 요청: [이해한 내용]

🔍 영향: [수정 파일] → [영향받는 기능]

🔨 계획:
1. [단계] (UI→DB→피드백 전체 포함)
2. ...

🔎 동일 패턴: [전수 검색 결과 — N곳 발견, 함께 수정 제안]

⚠️ 사이드이펙트: [예측되는 문제 + 해결 방안]

🔄 난이도: [높으면 Ralph Loop 제안]

진행?
```

---

## 🔧 작업 규칙

**코드:**
- 주석/커밋: 한국어
- 한 번에 하나 기능
- 복잡한 로직은 주석으로 "왜" 설명

**에러 대응:**
- 1-2회: 직접 수정
- 3회: 다른 접근법 제안
- 5회: 중단, 현재 상태 커밋, 선택지 제시

**커밋:**
- 작동하는 상태에서만
- 커밋 전 CHANGELOG.md 업데이트
- 형식: `feat:`, `fix:`, `refactor:`
- 코드 변경 완료 후 즉시 커밋 (여러 기능을 배치로 묶지 않기)
- 다음 작업으로 넘어가기 전에 반드시 현재 변경 커밋 완료

---

## 🔄 세션 프로토콜

**시작:**
1. 이 파일 + docs/CHANGELOG.md 읽기
2. "지난번 [X]까지, 오늘 [Y] 할까요?" 제안
3. 로컬 repo 상태 확인 (`git status`) — 충돌/untracked 파일 정리 후 작업 시작

**진행 중:**
- 대규모 작업(3단계 이상)은 **페이즈별 체크포인트** 설정
- 각 페이즈 완료 시 즉시 커밋 (세션 종료로 진행 손실 방지)
- 작업 규모가 세션 용량 초과 예상 시 미리 알리기

**종료 (필수):**
docs/CHANGELOG.md에 기록:
- 완료/진행중/다음
- 블로커 있으면 명시
- 미완료 작업의 재개 지점 명확히 기록

---

## 🔐 보안 체크리스트 (작업 시작 전 확인)

### 필수 확인사항
- [ ] Firebase Security Rules가 UID 기반으로 설정되어 있는가?
- [ ] localStorage 데이터 로드 시 `validateTasks()` 검증을 사용하는가?
- [ ] 사용자 입력을 DOM에 삽입할 때 `escapeHtml()` 사용하는가?

### 코드 작성 시 보안 규칙
1. **Firebase 키**: 클라이언트 노출은 OK, 대신 Security Rules 필수
2. **innerHTML 사용 시**: 반드시 `escapeHtml()` 함수로 이스케이프
3. **localStorage 로드**: `safeParseJSON()`, `validateTasks()` 사용
4. **전역 함수 노출**: 최소화 (window.firebase* 등)

---

## ⚙️ 프로젝트 특이사항

- **배포**: GitHub Pages
- **URL**: https://clusteruni-debug.github.io/To-do-list-for-adhd/navigator-v5.html
- 단일 파일 아키텍처 (navigator-v5.html)
- Firebase: Security Rules UID 기반 필수
- localStorage + Firebase 이중 저장
- 날짜: getLocalDateStr() / getLocalDateTimeStr() 사용 (UTC 버그 전수 수정 완료)

---

## 📁 파일 구조
```
To-do-list-for-adhd/
├── navigator-v5.html    # 메인 앱 (단일 파일)
├── sw.js               # Service Worker (PWA)
├── manifest.json       # PWA 매니페스트
├── docs/
│   └── CHANGELOG.md    # 작업 이력
└── CLAUDE.md           # 프로젝트 컨텍스트
```

## 실행 방법
```bash
npx serve -p 5000
# http://localhost:5000/navigator-v5.html
```

---

## 🔗 프로젝트 연동 현황

### telegram-event-bot ↔ Navigator
```
telegram-event-bot  ──(📋 Navigator 버튼)──▶  Navigator
     │                                           │
     └── URL 파라미터(?import=base64) ──────────▶│
                                                 │
Navigator  ──(Task 완료)──▶  이벤트 participated 상태 업데이트
```
- **상태**: ✅ 연동 완료
- **기능**: 이벤트 → Task 변환, 완료 시 상태 동기화

### 자산관리 ↔ Navigator
```
Navigator  ──(📤 자산관리 버튼)──▶  수익 데이터 클립보드 복사
                                         │
자산관리  ──(📤 Navigator 수익 가져오기)──◀──┘
```
- **상태**: ✅ 연동 완료
- **연동 방식**: 클립보드 JSON 데이터 교환

### x-article-editor ↔ Navigator (예정)
```
Navigator  ──(아티클 작성 Task)──▶  x-article-editor 초안 생성
```
- **상태**: 🔵 계획중

---

## 📊 개선 로드맵

### PM 관점 (제품 전략)

| 우선순위 | 기능 | 설명 | 상태 |
|---------|------|------|------|
| P0 | 수익 대시보드 | 월별/주별 수익 그래프, 카테고리별 비교 | ✅ |
| P0 | 마감일 푸시 알림 | 브라우저 알림 스케줄링 (D-1, 당일) | ✅ |
| P0 | 라이프 리듬 트래커 | 기상/출퇴근/취침 기록 + 통근시간 추적 | ✅ |
| P1 | 데이터 내보내기 | JSON/CSV 백업/복원 기능 | ✅ |
| P1 | 온보딩 가이드 | 첫 사용자 기능 발견 개선 | ✅ |
| P2 | 주간/월간 리포트 | 완료율, 수익 요약 자동 생성 | ✅ |
| P2 | 자산관리 연동 | 완료 Task 수익 → 자산관리 자동 기록 | ✅ |

### UX 관점 (사용자 경험)

| 우선순위 | 기능 | 설명 | 상태 |
|---------|------|------|------|
| P0 | 퀵입력 카테고리 | `#부업 제목` 형식으로 카테고리 지정 | ✅ |
| P1 | 탭 구조 개선 | 6개 → 5개 축소 (더보기 메뉴) | ✅ |
| P1 | Task 카드 간소화 | 액션 버튼 스와이프/롱프레스로 숨김 | ✅ |
| P1 | 키보드 단축키 | n=추가, Enter=완료, e=편집 | ✅ |
| P2 | 접근성 개선 | aria-label, 포커스 스타일, 색상 대비 | 🟡 기초 완료 |
| P2 | 포모도로 통합 | 25분 집중 + 5분 휴식 사이클 | ✅ |

---

## 🐛 버그 (수정 필요)

| 버그 | 설명 | 우선순위 | 상태 |
|------|------|---------|------|
| ~~더보기 드롭다운 안 열림~~ | ~~더보기 버튼 클릭해도 메뉴가 표시되지 않음~~ | P0 | ✅ 해결 |
| ~~반복 작업 완료 누적~~ | ~~매일 반복 작업 완료 시 계속 누적됨~~ | P0 | ✅ 해결 |
| ~~완료 취소 시 게이지 버그~~ | ~~작업 완료 후 취소해도 완료 게이지(진행률)가 줄어들지 않음~~ | P0 | ✅ 해결 |

## 🎨 UX 개선 필요

| 문제 | 설명 | 우선순위 | 상태 |
|------|------|---------|------|
| ~~일상/가족 탭 수정/삭제 불가~~ | ~~항목은 보이지만 수정/삭제 버튼이 없음~~ | P0 | ✅ 해결 |
| ~~취소 기능 불명확~~ | ~~완료 버튼만 있고 취소 버튼이 따로 없어서 취소 개념이 명확하지 않음~~ | P1 | ✅ 해결 |
| ~~홈 버튼들 혼란~~ | ~~새작업 추가, 글쓰기, 상세 입력 버튼들의 기능 구분이 안 됨~~ | P1 | ✅ 해결 |
| ~~섹션 구분 불명확~~ | ~~2분룰, 5분이하, 24시간 내 등 섹션 간 구분과 각 섹션의 목적이 불명확~~ | P1 | ✅ 해결 |

---

## 🔥 현재 작업 (WIP)

| 작업 | 우선순위 | 상태 |
|------|---------|------|
| SVG 아이콘 교체 | P2 | 🔴 대기 |

### ✅ 최근 완료 (2026-02-05)
- [x] XSS 전수 방어 - innerHTML 38곳 escapeHtml() 적용 ✅
- [x] 접근성 65개 aria-label + 포커스 트랩 + WCAG 색상 대비 ✅
- [x] renderStatic 스크롤/포커스 보존 ✅
- [x] Firebase 온오프라인 자동 동기화 피드백 ✅
- [x] 터치타겟 44px + 삭제 confirm 보완 ✅
- [x] 전역 함수 Nav 네임스페이스 정리 ✅
- [x] 온보딩 기능 투어 (4-step 하이라이트) ✅
- [x] 주간/월간 리포트 (대시보드) ✅
- [x] 포모도로 타이머 UI 연결 ✅
- [x] PWA SW v6.3 + 앱 업데이트 감지 ✅
- [x] 4K 레이아웃 + favicon/apple-touch-icon ✅

---

## 주요 기능 (현재)
- 카테고리별 작업 관리 (본업, 부업, 일상, 가족)
- 예상 수익/소요시간 추적
- Firebase 클라우드 동기화
- 서브태스크, 반복 Task
- 퀵 타이머, 포커스 모드
- 캘린더/히스토리
- telegram-event-bot 연동 (이벤트 → Task)
- **라이프 리듬 트래커** (기상/집출발/회사도착/회사출발/집도착/취침 + 통근시간 자동계산)

---

## 🏗️ 대규모 작업 가이드

### 작업 분할 원칙
- 3단계 이상 작업은 **독립적으로 커밋 가능한 페이즈**로 분할
- 각 페이즈는 앱이 정상 작동하는 상태로 끝나야 함

### 작업 시작 전 repo 상태 점검
```
□ git status 깨끗한가?
□ 로컬과 리모트 동기화 상태 확인
□ 작업 브랜치가 올바른가?
```

### 반복 작업 자동화
- 자주 반복되는 워크플로우는 Custom Skill 사용
- 예: `/security-scan`, `/clean-history`, `/full-deploy`, `/ralph-loop`

---

## 📌 빠른 명령

| 상황 | 말할 것 |
|------|---------|
| 구현 전 | "영향도 먼저 분석해" |
| 전체 흐름 | "DB까지 전체 구현해" |
| 패턴 확인 | "다른 곳도 필요한지 확인해" |
| 검증 | "검증하고 테스트 시나리오 알려줘" |
| 종료 | "CHANGELOG 업데이트하고 마무리" |
| 대규모 작업 | "페이즈로 나누고 각 단계마다 커밋해" |
| 보안 정리 | "전수 스캔 먼저 하고 목록 보여줘" |
| 세션 관리 | "이번 세션에 어디까지 가능한지 알려줘" |
